const STRINGS = {
  en: {
    appTitle: 'Task Manager',
    loginTitle: 'Sign In',
    username: 'Username',
    password: 'Password',
    loginButton: 'Login',
    logout: 'Logout',
    adminDashboard: 'Admin Dashboard',
    userTasks: 'My Tasks',
    createTask: 'Create Task',
    taskTitle: 'Task Title',
    taskDescription: 'Description',
    deadline: 'Deadline',
    assignedTo: 'Assign to',
    status: 'Status',
    status_pending: 'Pending',
    status_in_progress: 'In Progress',
    status_done: 'Completed',
    uploadFiles: 'Upload files',
    save: 'Save',
    filterByUser: 'Filter by user',
    filterByStatus: 'Filter by status',
    filterByDate: 'Filter by date',
    noTasks: 'No tasks found',
    languageEnglish: 'English',
    languageArabic: 'Arabic',
    invalidCredentials: 'Invalid username or password',
    back: 'Back',
    edit: 'Edit',
    createdBy: 'Created by',
    adminLabel: 'Admin',
    view: 'View',
    filesHelpText: 'Files can be uploaded by both admin and staff when creating/updating tasks.',
    recentUpdates: 'Recent Updates',
    noUpdates: 'No updates yet.',
    statusLabel: 'Status',
    usersPageTitle: 'Users',
    addUser: 'Add User',
    existingUsers: 'Existing Users',
    role: 'Role',
    role_user: 'User',
    role_admin: 'Admin',
    notificationsTitle: 'Notifications',
    noNotifications: 'No new notifications.',
    viewTask: 'View Task',
    email: 'Email',
    emailHelpText: 'Email address for notifications (optional)',
    editTask: 'Edit Task',
    notePlaceholder: 'Work done / description (optional)',
    makeReport: 'Make a report',
    notification_task_assigned: 'New task assigned by {by}: {title}',
    notification_task_updated: 'Staff ({by}) updated task status (ID: {id}) - Status: {status} - Note: {note} - Attachment: {fileCount} file(s) uploaded',
    notification_task_updated_no_note: 'Staff ({by}) updated task status (ID: {id}) - Status: {status} - Attachment: {fileCount} file(s) uploaded',
    notification_task_updated_no_file: 'Staff ({by}) updated task status (ID: {id}) - Status: {status} - Note: {note}',
    notification_task_updated_simple: 'Staff ({by}) updated task status (ID: {id}) - Status: {status}',
    status_completed: 'Completed',
    status_in_progress_text: 'In Progress',
    status_pending_text: 'Pending',
    unread: 'Unread',
    read: 'Read'
  },
  ar: {
    appTitle: 'نظام إدارة المهام',
    loginTitle: 'تسجيل الدخول',
    username: 'اسم المستخدم',
    password: 'كلمة المرور',
    loginButton: 'دخول',
    logout: 'تسجيل الخروج',
    adminDashboard: 'لوحة التحكم (المدير)',
    userTasks: 'مهامي',
    createTask: 'إنشاء مهمة',
    taskTitle: 'عنوان المهمة',
    taskDescription: 'وصف المهمة',
    deadline: 'تاريخ التسليم',
    assignedTo: 'تعيين إلى',
    status: 'الحالة',
    status_pending: 'قيد الانتظار',
    status_in_progress: 'قيد التنفيذ',
    status_done: 'مكتملة',
    uploadFiles: 'رفع الملفات',
    save: 'حفظ',
    filterByUser: 'تصفية حسب الموظف',
    filterByStatus: 'تصفية حسب الحالة',
    filterByDate: 'تصفية حسب التاريخ',
    noTasks: 'لا توجد مهام',
    languageEnglish: 'الإنجليزية',
    languageArabic: 'العربية',
    invalidCredentials: 'اسم المستخدم أو كلمة المرور غير صحيحة',
    back: 'رجوع',
    edit: 'تعديل',
    createdBy: 'أنشئت بواسطة',
    adminLabel: 'المدير',
    view: 'عرض',
    filesHelpText: 'يمكن للمدير والموظفين رفع الملفات عند إنشاء أو تحديث المهمة.',
    recentUpdates: 'أحدث التحديثات',
    noUpdates: 'لا توجد تحديثات مسجلة بعد.',
    statusLabel: 'الحالة',
    usersPageTitle: 'المستخدمون',
    addUser: 'إضافة مستخدم',
    existingUsers: 'المستخدمون الحاليون',
    role: 'الدور',
    role_user: 'موظف',
    role_admin: 'مدير',
    notificationsTitle: 'الإشعارات',
    noNotifications: 'لا توجد إشعارات جديدة.',
    viewTask: 'عرض المهمة',
    email: 'البريد الإلكتروني',
    emailHelpText: 'عنوان البريد الإلكتروني للإشعارات (اختياري)',
    editTask: 'تعديل المهمة',
    notePlaceholder: 'الوصف / ما تم إنجازه (اختياري)',
    makeReport: 'إنشاء تقرير',
    notification_task_assigned: 'تم تعيين مهمة جديدة بواسطة {by}: {title}',
    notification_task_updated: 'قام الموظف ({by}) بتحديث حالة المهمة (ID: {id}) - الحالة: {status} - الملاحظة: {note} - المرفق: تم رفع {fileCount} ملف',
    notification_task_updated_no_note: 'قام الموظف ({by}) بتحديث حالة المهمة (ID: {id}) - الحالة: {status} - المرفق: تم رفع {fileCount} ملف',
    notification_task_updated_no_file: 'قام الموظف ({by}) بتحديث حالة المهمة (ID: {id}) - الحالة: {status} - الملاحظة: {note}',
    notification_task_updated_simple: 'قام الموظف ({by}) بتحديث حالة المهمة (ID: {id}) - الحالة: {status}',
    status_completed: 'مكتملة',
    status_in_progress_text: 'قيد التنفيذ',
    status_pending_text: 'قيد الانتظار',
    unread: 'غير مقروء',
    read: 'مقروء'
  }
};

function getI18nMiddleware() {
  return (req, res, next) => {
    const lang = req.session.lang === 'ar' ? 'ar' : 'en';
    req.lang = lang;
    req.dir = lang === 'ar' ? 'rtl' : 'ltr';
    req.t = (key) => STRINGS[lang][key] || key;
    res.locals.t = req.t;
    res.locals.lang = lang;
    res.locals.dir = req.dir;
    res.locals.currentUser = req.user;
    next();
  };
}

module.exports = {
  getI18nMiddleware
};


