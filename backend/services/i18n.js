const STRINGS = {
  en: {
    appTitle: 'Task Manager',
    loginTitle: 'Sign In',
    username: 'Username',
    password: 'Password',
    loginButton: 'Login',
    logout: 'Logout',
    adminDashboard: 'Admin Dashboard',
    userTasks: 'My Tasks',
    myTasks: 'My Tasks',
    createTask: 'Create Task',
    taskTitle: 'Task Title',
    taskDescription: 'Description',
    description: 'Description',
    deadline: 'Estimated Completion Date',
    completedAt: 'Completion Date',
    givenDate: 'Start Date',
    location: 'Location',
    assignedTo: 'Assign to',
    status: 'Status',
    status_pending: 'Pending',
    status_in_progress: 'In Progress',
    status_done: 'Completed',
    totalTasks: 'Total Tasks',
    completedTasks: 'Completed Tasks',
    pendingTasks: 'Pending Tasks',
    inProgressTasks: 'In Progress Tasks',
    urgentTasks: 'Urgent Tasks',
    mostAssignedUser: 'Most Assigned User',
    uploadFiles: 'Upload files',
    save: 'Save',
    addUser: 'Add User',
    addMunicipality: 'Add Municipality',
    municipalityAddedSuccessfully: 'Municipality added successfully',
    errorAddingMunicipality: 'Error adding municipality',
    addRegion: 'Add Region',
    regionAddedSuccessfully: 'Region added successfully',
    errorAddingRegion: 'Error adding region',
    addCity: 'Add City',
    cityAddedSuccessfully: 'City added successfully',
    errorAddingCity: 'Error adding city',
    translate: 'Translate',
    optional: 'Optional',
    cancel: 'Cancel',
    pleaseFillRequiredFields: 'Please fill all required fields',
    userAddedSuccessfully: 'User added successfully',
    errorAddingUser: 'Error adding user',
    delete: 'Delete',
    deleteUser: 'Delete User',
    confirmDeleteUser: 'Are you sure you want to delete user',
    errorDeletingUser: 'Error deleting user',
    filterByUser: 'Filter by user',
    filterByStatus: 'Filter by status',
    filterByCity: 'Filter by city',
    filterByDate: 'Filter by date',
    filterByGivenDate: 'Given Date',
    filterByCompletedDate: 'Completion Date',
    filterByDepartment: 'Department',
    filterByArchive: 'Archive',
    filterByMunicipality: 'Filter by municipality',
    filterByRegion: 'Filter by region',
    selectFilterType: 'Select filter type',
    filters: 'Filters',
    personnel: 'Personnel',
    municipality: 'Municipality',
    region: 'Region',
    city: 'City',
    date: 'Date',
    resetFilters: 'Reset Filters',
    exportExcel: 'Export to Excel',
    noTasks: 'No tasks found',
    languageEnglish: 'English',
    languageArabic: 'Arabic',
    languageTurkish: 'Turkish',
    invalidCredentials: 'Invalid username or password',
    back: 'Back',
    edit: 'Edit',
    createdBy: 'Created by',
    adminLabel: 'Admin',
    view: 'View',
    team: 'Team',
    responsible1: 'Responsible 1',
    responsible2: 'Responsible 2',
    responsible3: 'Responsible 3',
    filesHelpText: 'Files can be uploaded by both admin and staff when creating/updating tasks.',
    recentUpdates: 'Recent Updates',
    noUpdates: 'No updates yet.',
    statusLabel: 'Status',
    usersPageTitle: 'Users',
    addUser: 'Add User',
    existingUsers: 'Existing Users',
    role: 'Role',
    role_user: 'User',
    role_super_admin: 'Super Admin',
    role_admin: 'Admin',
    notificationsTitle: 'Notifications',
    noNotifications: 'No new notifications.',
    viewTask: 'View Task',
    email: 'Email',
    emailHelpText: 'Email address for notifications (optional)',
    editTask: 'Edit Task',
    notePlaceholder: 'Work done / description (optional)',
    makeReport: 'Make a report',
    notification_task_assigned: 'New task assigned by {by}: {title}',
    notification_task_updated: 'Staff ({by}) updated task status (ID: {id}) - Status: {status} - Note: {note} - Attachment: {fileCount} file(s) uploaded',
    notification_task_updated_no_note: 'Staff ({by}) updated task status (ID: {id}) - Status: {status} - Attachment: {fileCount} file(s) uploaded',
    notification_task_updated_no_file: 'Staff ({by}) updated task status (ID: {id}) - Status: {status} - Note: {note}',
    notification_task_updated_simple: 'Staff ({by}) updated task status (ID: {id}) - Status: {status}',
    status_completed: 'Completed',
    status_in_progress_text: 'In Progress',
    status_pending_text: 'Pending',
    unread: 'Unread',
    read: 'Read',
    home: 'Home',
    dashboard: 'Dashboard',
    menu: 'Menu',
    tasks: 'Tasks',
    reports: 'Reports',
    tarih: 'Date',
    konuSorumlusu: 'Subject Responsible',
    sorumlu: 'Responsible',
    sorumlu2: 'Responsible 2',
    sorumlu3: 'Responsible 3',
    bolge: 'Region',
    il: 'City',
    belediye: 'Municipality',
    departman: 'Department',
    arsiv: 'Archive',
    arsivVar: 'Yes',
    arsivYok: 'No',
    verilenIsTarihi: 'Given Job Date',
    tahminiIsBitistarihi: 'Estimated Job End Date',
    statusOnemli: 'Important',
    statusDevamEdiyor: 'In Progress',
    statusBitti: 'Completed',
    departmanSaha: 'Field',
    departmanBelediye: 'Municipality',
    departmanHukuk: 'Legal',
    departmanLisans: 'Licensing',
    departmanGenel: 'General',
    departmanInsanKaynaklari: 'Human Resources',
    isUrgent: 'Is Urgent?',
    urgent: 'Urgent',
    notUrgent: 'Not Urgent',
    shareFile: 'Share File',
    shareViaEmail: 'Share via Email',
    shareViaWhatsApp: 'Share via WhatsApp',
    shareViaLink: 'Copy Link',
    linkCopied: 'Link copied to clipboard!',
    shareFileTitle: 'Share Excel File',
    fileDownloaded: 'File downloaded',
    shareDownloadedFile: 'Share downloaded file',
    taskDetailsTitle: 'Task Details',
    basicInfo: 'General Info',
    responsibleInfo: 'Responsibles',
    dateInfo: 'Dates',
    attachments: 'Attachments'
  },
  tr: {
    appTitle: 'Görev Yönetimi',
    loginTitle: 'Giriş Yap',
    username: 'Kullanıcı Adı',
    password: 'Şifre',
    loginButton: 'Giriş',
    logout: 'Çıkış',
    adminDashboard: 'Yönetici Paneli',
    tasks: 'Görevler',
    userTasks: 'Görevlerim',
    myTasks: 'Görevlerim',
    createTask: 'Görev Oluştur',
    taskTitle: 'Görev Başlığı',
    taskSubject: 'İş Konusu',
    taskDescription: 'Açıklama',
    description: 'Açıklama',
    deadline: 'Tahmini İş Bitiş Tarihi',
    completedAt: 'Bitiş Tarihi',
    givenDate: 'İş Başlama Tarihi',
    location: 'Lokasyon',
    assignedTo: 'Atanan',
    status: 'Durum',
    status_pending: 'Beklemede',
    status_in_progress: 'Devam Ediyor',
    status_done: 'Tamamlandı',
    totalTasks: 'Toplam Görev',
    completedTasks: 'Tamamlanan Görevler',
    pendingTasks: 'Beklemede Olan Görevler',
    inProgressTasks: 'Devam Eden Görevler',
    urgentTasks: 'Acil Görevler',
    mostAssignedUser: 'En Çok Görev Alan Personel',
    uploadFiles: 'Dosya Yükle',
    save: 'Kaydet',
    filterByUser: 'Kullanıcıya göre filtrele',
    filterByStatus: 'Duruma göre filtrele',
    filterByCity: 'İle göre filtrele',
    filterByDate: 'Tarihe göre filtrele',
    filterByGivenDate: 'İş Verilme Tarihi',
    filterByCompletedDate: 'İş Bitiş Tarihi',
    filterByDepartment: 'Departman',
    filterByArchive: 'Arşiv',
    filterByMunicipality: 'Belediyeye göre filtrele',
    filterByRegion: 'Bölgeye göre filtrele',
    selectFilterType: 'Filtre tipi seçin',
    filters: 'Filtreler',
    personnel: 'Personel',
    municipality: 'Belediye',
    region: 'Bölge',
    city: 'İl',
    date: 'Tarih',
    resetFilters: 'Filtreleri Sıfırla',
    exportExcel: 'Excel\'e Aktar',
    noTasks: 'Görev bulunamadı',
    languageEnglish: 'İngilizce',
    languageArabic: 'Arapça',
    languageTurkish: 'Türkçe',
    invalidCredentials: 'Geçersiz kullanıcı adı veya şifre',
    back: 'Geri',
    edit: 'Düzenle',
    createdBy: 'Oluşturan',
    adminLabel: 'Yönetici',
    team: 'Ekip',
    responsible1: 'Sorumlu 1',
    responsible2: 'Sorumlu 2',
    responsible3: 'Sorumlu 3',
    view: 'Görüntüle',
    filesHelpText: 'Dosyalar görev oluştururken veya güncellerken hem yönetici hem de personel tarafından yüklenebilir.',
    recentUpdates: 'Son Güncellemeler',
    noUpdates: 'Henüz güncelleme yok.',
    statusLabel: 'Durum',
    usersPageTitle: 'Kullanıcılar',
    addUser: 'Kullanıcı Ekle',
    addMunicipality: 'Belediye Ekle',
    municipalityAddedSuccessfully: 'Belediye başarıyla eklendi',
    errorAddingMunicipality: 'Belediye eklenirken hata oluştu',
    addRegion: 'Bölge Ekle',
    regionAddedSuccessfully: 'Bölge başarıyla eklendi',
    errorAddingRegion: 'Bölge eklenirken hata oluştu',
    addCity: 'İl Ekle',
    cityAddedSuccessfully: 'İl başarıyla eklendi',
    errorAddingCity: 'İl eklenirken hata oluştu',
    translate: 'Çevir',
    existingUsers: 'Mevcut Kullanıcılar',
    role: 'Rol',
    role_user: 'Kullanıcı',
    role_super_admin: 'Süper Yönetici',
    role_admin: 'Yönetici',
    notificationsTitle: 'Bildirimler',
    noNotifications: 'Yeni bildirim yok.',
    viewTask: 'Görevi Görüntüle',
    email: 'E-posta',
    emailHelpText: 'Bildirimler için e-posta adresi (isteğe bağlı)',
    editTask: 'Görevi Düzenle',
    notePlaceholder: 'Yapılan iş / açıklama (isteğe bağlı)',
    makeReport: 'Rapor oluştur',
    notification_task_assigned: '{by} tarafından yeni görev atandı: {title}',
    notification_task_updated: 'Personel ({by}) görev durumunu güncelledi (ID: {id}) - Durum: {status} - Not: {note} - Ek: {fileCount} dosya yüklendi',
    notification_task_updated_no_note: 'Personel ({by}) görev durumunu güncelledi (ID: {id}) - Durum: {status} - Ek: {fileCount} dosya yüklendi',
    notification_task_updated_no_file: 'Personel ({by}) görev durumunu güncelledi (ID: {id}) - Durum: {status} - Not: {note}',
    notification_task_updated_simple: 'Personel ({by}) görev durumunu güncelledi (ID: {id}) - Durum: {status}',
    status_completed: 'Tamamlandı',
    status_in_progress_text: 'Devam Ediyor',
    status_pending_text: 'Beklemede',
    unread: 'Okunmamış',
    read: 'Okundu',
    home: 'Ana Sayfa',
    dashboard: 'Kontrol Paneli',
    menu: 'Menü',
    reports: 'Raporlar',
    tarih: 'Tarih',
    konuSorumlusu: 'Konu Sorumlusu',
    sorumlu: 'Sorumlu',
    sorumlu2: 'Sorumlu 2',
    sorumlu3: 'Sorumlu 3',
    bolge: 'Bölge',
    il: 'İl',
    belediye: 'Belediye',
    departman: 'Departman',
    arsiv: 'Arşiv',
    arsivVar: 'Var',
    arsivYok: 'Yok',
    verilenIsTarihi: 'Verilen İş Tarihi',
    tahminiIsBitistarihi: 'Tahmini İş Bitiş Tarihi',
    statusOnemli: 'Önemli',
    statusDevamEdiyor: 'Devam Ediyor',
    statusBitti: 'Bitti',
    departmanSaha: 'Saha',
    departmanBelediye: 'Belediye',
    departmanHukuk: 'Hukuk',
    departmanLisans: 'Lisans',
    departmanGenel: 'Genel',
    departmanInsanKaynaklari: 'İnsan Kaynakları',
    isUrgent: 'Acil mi?',
    urgent: 'Acil',
    notUrgent: 'Acil Değil',
    shareFile: 'Dosyayı Paylaş',
    shareViaEmail: 'E-posta ile Paylaş',
    shareViaWhatsApp: 'WhatsApp ile Paylaş',
    shareViaLink: 'Linki Kopyala',
    linkCopied: 'Link panoya kopyalandı!',
    shareFileTitle: 'Excel Dosyasını Paylaş',
    fileDownloaded: 'Dosya indirildi',
    shareDownloadedFile: 'İndirilen dosyayı paylaş',
    taskDetailsTitle: 'Görev Detayları',
    basicInfo: 'Genel Bilgiler',
    responsibleInfo: 'Sorumlular',
    dateInfo: 'Tarihler',
    attachments: 'Ekler'
  },
  ar: {
    appTitle: 'نظام إدارة المهام',
    loginTitle: 'تسجيل الدخول',
    username: 'اسم المستخدم',
    password: 'كلمة المرور',
    loginButton: 'دخول',
    logout: 'تسجيل الخروج',
    adminDashboard: 'لوحة التحكم (المدير)',
    userTasks: 'مهامي',
    myTasks: 'مهامي',
    createTask: 'إنشاء مهمة',
    taskTitle: 'عنوان المهمة',
    taskSubject: 'موضوع العمل',
    taskDescription: 'وصف المهمة',
    description: 'الوصف',
    deadline: 'تاريخ انتهاء العمل المتوقع',
    completedAt: 'تاريخ الانتهاء',
    givenDate: 'تاريخ بدء العمل',
    location: 'الموقع',
    assignedTo: 'تعيين إلى',
    status: 'الحالة',
    status_pending: 'قيد الانتظار',
    status_in_progress: 'قيد التنفيذ',
    status_done: 'مكتملة',
    totalTasks: 'إجمالي المهام',
    uploadFiles: 'رفع الملفات',
    save: 'حفظ',
    filterByUser: 'تصفية حسب الموظف',
    filterByStatus: 'تصفية حسب الحالة',
    filterByCity: 'تصفية حسب المحافظة',
    filterByDate: 'تصفية حسب التاريخ',
    filterByGivenDate: 'تاريخ الإعطاء',
    filterByCompletedDate: 'تاريخ انتهاء العمل',
    filterByDepartment: 'القسم',
    filterByArchive: 'الأرشيف',
    filterByMunicipality: 'تصفية حسب البلدية',
    filterByRegion: 'تصفية حسب المنطقة',
    selectFilterType: 'اختر نوع التصفية',
    filters: 'التصفية',
    personnel: 'الموظف',
    municipality: 'البلدية',
    region: 'المنطقة',
    city: 'المحافظة',
    date: 'التاريخ',
    resetFilters: 'إعادة تعيين المرشحات',
    exportExcel: 'تصدير إلى Excel',
    noTasks: 'لا توجد مهام',
    languageEnglish: 'الإنجليزية',
    languageArabic: 'العربية',
    languageTurkish: 'التركية',
    invalidCredentials: 'اسم المستخدم أو كلمة المرور غير صحيحة',
    back: 'رجوع',
    edit: 'تعديل',
    createdBy: 'أنشئت بواسطة',
    adminLabel: 'المدير',
    team: 'الفريق',
    responsible1: 'المسؤول 1',
    responsible2: 'المسؤول 2',
    responsible3: 'المسؤول 3',
    view: 'عرض',
    filesHelpText: 'يمكن للمدير والموظفين رفع الملفات عند إنشاء أو تحديث المهمة.',
    recentUpdates: 'آخر التحديثات',
    noUpdates: 'لا توجد تحديثات مسجلة بعد.',
    statusLabel: 'الحالة',
    usersPageTitle: 'المستخدمون',
    addUser: 'إضافة مستخدم',
    addMunicipality: 'إضافة بلدية',
    municipalityAddedSuccessfully: 'تمت إضافة البلدية بنجاح',
    errorAddingMunicipality: 'حدث خطأ أثناء إضافة البلدية',
    addRegion: 'إضافة منطقة',
    regionAddedSuccessfully: 'تمت إضافة المنطقة بنجاح',
    errorAddingRegion: 'حدث خطأ أثناء إضافة المنطقة',
    addCity: 'إضافة محافظة',
    cityAddedSuccessfully: 'تمت إضافة المحافظة بنجاح',
    errorAddingCity: 'حدث خطأ أثناء إضافة المحافظة',
    translate: 'ترجمة',
    existingUsers: 'المستخدمون الحاليون',
    role: 'الدور',
    role_user: 'موظف',
    role_super_admin: 'مدير رئيسي',
    role_admin: 'مدير',
    notificationsTitle: 'الإشعارات',
    noNotifications: 'لا توجد إشعارات جديدة.',
    viewTask: 'عرض المهمة',
    email: 'البريد الإلكتروني',
    emailHelpText: 'عنوان البريد الإلكتروني للإشعارات (اختياري)',
    editTask: 'تعديل المهمة',
    notePlaceholder: 'الوصف / ما تم إنجازه (اختياري)',
    makeReport: 'إنشاء تقرير',
    notification_task_assigned: 'تم تعيين مهمة جديدة بواسطة {by}: {title}',
    notification_task_updated: 'قام الموظف ({by}) بتحديث حالة المهمة (ID: {id}) - الحالة: {status} - الملاحظة: {note} - المرفق: تم رفع {fileCount} ملف',
    notification_task_updated_no_note: 'قام الموظف ({by}) بتحديث حالة المهمة (ID: {id}) - الحالة: {status} - المرفق: تم رفع {fileCount} ملف',
    notification_task_updated_no_file: 'قام الموظف ({by}) بتحديث حالة المهمة (ID: {id}) - الحالة: {status} - الملاحظة: {note}',
    notification_task_updated_simple: 'قام الموظف ({by}) بتحديث حالة المهمة (ID: {id}) - الحالة: {status}',
    status_completed: 'مكتملة',
    status_in_progress_text: 'قيد التنفيذ',
    status_pending_text: 'قيد الانتظار',
    unread: 'غير مقروء',
    read: 'مقروء',
    home: 'الرئيسية',
    dashboard: 'لوحة التحكم',
    menu: 'القائمة',
    tasks: 'المهام',
    reports: 'التقارير',
    totalTasks: 'إجمالي المهام',
    completedTasks: 'المهام المكتملة',
    pendingTasks: 'المهام المعلقة',
    inProgressTasks: 'المهام قيد التنفيذ',
    urgentTasks: 'المهام العاجلة',
    mostAssignedUser: 'أكثر موظف تم تعيين المهام له',
    tarih: 'التاريخ',
    konuSorumlusu: 'مسؤول الموضوع',
    sorumlu: 'المسؤول',
    sorumlu2: 'المسؤول 2',
    sorumlu3: 'المسؤول 3',
    bolge: 'المنطقة',
    il: 'المدينة',
    belediye: 'البلدية',
    departman: 'القسم',
    arsiv: 'الأرشيف',
    arsivVar: 'نعم',
    arsivYok: 'لا',
    verilenIsTarihi: 'تاريخ إعطاء العمل',
    tahminiIsBitistarihi: 'تاريخ انتهاء العمل المتوقع',
    statusOnemli: 'مهم',
    statusDevamEdiyor: 'قيد التنفيذ',
    statusBitti: 'انتهى',
    departmanSaha: 'الميدان',
    departmanBelediye: 'البلدية',
    departmanHukuk: 'القانون',
    departmanLisans: 'التراخيص',
    departmanGenel: 'عام',
    departmanInsanKaynaklari: 'الموارد البشرية',
    isUrgent: 'هل هو عاجل؟',
    urgent: 'عاجل',
    notUrgent: 'غير عاجل',
    shareFile: 'مشاركة الملف',
    shareViaEmail: 'مشاركة عبر البريد الإلكتروني',
    shareViaWhatsApp: 'مشاركة عبر واتساب',
    shareViaLink: 'نسخ الرابط',
    linkCopied: 'تم نسخ الرابط إلى الحافظة!',
    shareFileTitle: 'مشاركة ملف Excel',
    fileDownloaded: 'تم تنزيل الملف',
    shareDownloadedFile: 'مشاركة الملف الذي تم تنزيله',
    taskDetailsTitle: 'تفاصيل المهمة',
    basicInfo: 'معلومات عامة',
    responsibleInfo: 'المسؤولون',
    dateInfo: 'التواريخ',
    attachments: 'المرفقات'
  }
};

function getI18nMiddleware() {
  return (req, res, next) => {
    try {
      const sessionLang = req.session?.lang;
      let lang = 'ar'; // Varsayılan dil Arapça
      if (sessionLang === 'en') {
        lang = 'en';
      } else if (sessionLang === 'tr') {
        lang = 'tr';
      } else if (sessionLang === 'ar') {
        lang = 'ar';
      }
      // Eğer session'da dil yoksa, varsayılan olarak Arapça ayarla
      if (!sessionLang && req.session) {
        req.session.lang = 'ar';
      }
      req.lang = lang;
      req.dir = lang === 'ar' ? 'rtl' : 'ltr';
      req.t = (key) => STRINGS[lang]?.[key] || key;
      res.locals.t = req.t;
      res.locals.lang = lang;
      res.locals.dir = req.dir;
      res.locals.currentUser = req.user;
      next();
    } catch (error) {
      console.error('⚠️  Error in i18n middleware (non-fatal):', error.message);
      // Fallback to default values
      req.lang = 'ar';
      req.dir = 'rtl';
      req.t = (key) => key;
      res.locals.t = req.t;
      res.locals.lang = 'ar';
      res.locals.dir = 'rtl';
      res.locals.currentUser = req.user;
      next();
    }
  };
}

module.exports = {
  getI18nMiddleware
};


